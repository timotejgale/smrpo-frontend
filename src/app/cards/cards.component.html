<div class="uk-container">
  <!-- New card modal toggle button.
       Only product owner or kanban master can add new cards -->
  <div *ngIf="isUserProductOwner_inGroup || isUserKanbanMaster_inGroup">
      <button class="uk-button uk-button-primary newCardButton" (click)="loadModal()" uk-toggle="target: #new-card-modal">Nova kartica</button>
  </div>


  <!-- new card modal -->
<div id="new-card-modal" uk-modal>
  <div class="uk-modal-dialog uk-modal-body uk-overflow-auto">
    <button class="uk-modal-close-default" type="button" (click)="cancelCard()" uk-close></button>
    <h2 class="uk-modal-title">{{cardsModalTitle}}</h2>
    <!-- Cards form -->
    <form (ngSubmit)="saveCard()" [formGroup]="newCardForm">
      <fieldset class="uk-fieldset">
        <!-- Card id
        <div class="uk-margin">
          <label class="uk-form-label" for="edit-id">Številka kartice</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="edit-id" type="text" formControlName="id" >
          </div>
        </div> -->
        <!-- Card title -->
        <div class="uk-margin">
          <label class="uk-form-label" for="edit-code-name">Naziv kartice</label>
          <div class="uk-form-controls">
            <input class="uk-input" id="edit-title" type="text" placeholder="Naziv kartice" formControlName="title" [ngClass]="{'danger-input uk-animation-shake' : !newCardForm.get('title').valid && newCardForm.get('title').touched}">
          </div>
        </div>
        <span class="uk-alert-danger"
        *ngIf="!newCardForm.get('title').valid && newCardForm.get('title').touched">
          Vnesi naziv kartice
        </span>

        <!-- Card description -->
        <div class="uk-margin">
          <label class="uk-form-label" for="edit-description">Opis kartice</label>
          <div class="uk-form-controls">
            <textarea class="uk-textarea" rows="5" id="edit-description" type="text" placeholder="Opis kartice" formControlName="description"  [ngClass]="{'danger-input uk-animation-shake' : !newCardForm.get('description').valid && newCardForm.get('description').touched}"></textarea>
          </div>
        </div>
        <span class="uk-alert-danger"
        *ngIf="!newCardForm.get('description').valid && newCardForm.get('description').touched">
          Vnesi opis kartice
        </span>

        <!-- Show all projects -->
        <div class="uk-form-controls  uk-margin">
          <label class="uk-form-label" for="edit-project">Projekt</label>
          <select [(ngModel)]="selectedProject" (change)="updateTitle()" class="uk-select" id="edit-project" formControlName="project">
              <ng-container *ngFor="let project of currentUserProjects">
                  <option [ngValue]="project" >{{project.title}}</option>
              </ng-container>    
          </select>
        </div>
        <span class="uk-alert-danger"
              *ngIf="!newCardForm.get('project').valid && newCardForm.get('project').touched">
          Izberi projekt
        </span>

        <!-- Card assignee -->
        <div class="uk-form-controls  uk-margin">
          <label class="uk-form-label" for="edit-assignee">Zadolženi razvijalec</label>
          <select class="uk-select" id="edit-assignee" formControlName="assignee">
            <option selected  id="nullSelection"></option> 
            <ng-container *ngFor="let groupMember of selectedProject?.group_data.users">
              <option disabled *ngIf="!groupMember.group_active && groupMember.allowed_group_roles.includes(1)" [ngValue]="groupMember">{{groupMember.name + " " +  groupMember.surname}} (neaktiven v skupini)</option>
              <option  *ngIf="groupMember.group_active && groupMember.allowed_group_roles.includes(1)" [ngValue]="groupMember">{{groupMember.name + " " +  groupMember.surname}}</option>
            </ng-container>  
          </select>
        </div>
        <span class="uk-alert-danger"
              *ngIf="!newCardForm.get('assignee').valid && newCardForm.get('assignee').touched">
          Izberi zadolženega
        </span>

        <!-- Deadline -->
        <div class="uk-margin">
          <label class="uk-form-label" for="edit-deadline">Rok</label>
          <div class="uk-form-controls">
            <p-calendar id="edit-deadline" [locale]="sl" [minDate]="today" formControlName="deadline" dateFormat="dd.mm.yy" showButtonBar="true"  [ngClass]="{'danger-input uk-animation-shake' : !newCardForm.get('deadline').valid && newCardForm.get('deadline').touched}"  readonlyInput="true"></p-calendar>
          </div>
        </div>
        <span class="uk-alert-danger"
        *ngIf="!newCardForm.get('deadline').valid && newCardForm.get('deadline').touched &&  newCardForm.get('deadline').dirty">
          Izberi rok
        </span>

        <!-- Card prority -->
        <div class="uk-form-controls  uk-margin">
          <label class="uk-form-label" for="edit-priority">Prioriteta</label>
          <select class="uk-select" id="edit-priority" formControlName="priority">
            <ng-container *ngFor="let priority of priorities">
                <option [ngValue]="priority"  >{{priority.title}}</option>
            </ng-container>     
          </select>
        </div>
        <span class="uk-alert-danger"
              *ngIf="!newCardForm.get('priority').valid && newCardForm.get('priority').touched">
          Izberi prioriteto
        </span>

        <!-- Card size -->
        <div class="uk-form-controls  uk-margin">
            <label class="uk-form-label" for="edit-size">Ocena zahtevnosti</label>
            <input class="uk-input" id="edit-size" type="number" formControlName="size">
        </div>


        <!-- Card type 
        <div class="uk-form-controls  uk-margin"  *ngIf="isUserKanbanMaster_inGroup">
          <label><input class="uk-checkbox" type="checkbox" [checked]="isUserKanbanMaster_inGroup" formControlName="typeSilver"> Nujna zahteva</label>
        </div>-->

        <div class="uk-text-right">
          <button class="uk-button uk-button-default uk-modal-close" type="button" (click)="closeModal()">Prekliči</button>
          <button class="uk-button uk-button-primary" type="submit" [disabled]="!newCardForm.valid">Shrani</button>
        </div>
      </fieldset>
    </form>
  </div>
</div>

</div>

